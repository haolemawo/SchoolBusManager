"use strict";function deserialize(n,t){for(var i in n)n.hasOwnProperty(i)&&(typeof n[i]=="object"?deserialize(n[i],t[i]):t!=undefined&&t[i]!=undefined&&(t[i]=n[i]))}function setCookie(n,t){var i=new Date;i.setTime(i.getTime()+24e5);document.cookie=n+"="+escape(t)+";expires="+i.toUTCString()+";path=/"}function getCookie(n){var t,i=new RegExp("(^| )"+n+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?unescape(t[2]):null}function delCookie(n){var t=new Date,i;t.setTime(t.getTime()-1);i=getCookie(n);i!==null&&(document.cookie=n+"=nothing;expires="+t.toUTCString()+";path=/")}function GetURLOption(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)"),t=location.href.substr(location.href.indexOf("?")+1).match(i);return t===null?"nullStr":t[2]}var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),GetBusResultData=function(){function n(){this.Bus=new SchoolBusObject;this.AHChecked=0;this.LSChecked=0;this.CSChecked=0;this.DirectGoHome=0;this.Total=0}return n}(),GetStudentsData=function(){function n(){this.StudentList=[new StudentObject];this.Count=0}return n}(),NewReportData=function(){function n(){this.Report=new BusReportObject}return n}(),GetUserNameData=function(){function n(){this.Name=""}return n}(),SignStudentData=function(){function n(){this.Student=new StudentObject;this.SignMode="";this.SignResult=!1}return n}(),PureMessageData=function(){function n(){this.Message=""}return n}(),DataObject=function(){function n(){this.CreatedAt="";this.UpdatedAt="";this.ObjectId=""}return n}(),Point=function(){function n(){this.X=0;this.Y=0}return n}(),UserGroup=function(){function n(){this.IsBusManager=!1;this.IsClassTeacher=!1;this.IsParent=!1}return n}(),UserObject=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.CurrentPoint=new Point,t.HeadImagePath="",t.Password="",t.PhoneNumber="",t.RealName="",t.Sex="",t.UserGroup=new UserGroup,t.UserName="",t}return __extends(t,n),t}(DataObject),SchoolBusObject=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.BusName="",t.TeacherID="",t.AHChecked=!1,t.CSChecked=!1,t.LSChecked=!1,t}return __extends(t,n),t}(DataObject),StudentObject=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.StudentName="",t.BusID="",t.Sex="",t.ClassID="",t.LSChecked=!1,t.CSChecked=!1,t.AHChecked=!1,t.TakingBus=!1,t.DirectGoHome=!1,t}return __extends(t,n),t}(DataObject),BusReportObject=function(){function n(){this.TeacherID="";this.BusID="";this.ReportType="";this.OtherData=""}return n}(),TSDictionary=function(){function n(n,t){this.keys=[];this.values=[];this.keys=n;this.values=t}return n.prototype.Add=function(n,t){this.keys.push(n);this.values.push(t)},n.prototype.Remove=function(n){var t=this.keys.indexOf(n,0);this.keys.splice(t,1);this.values.splice(t,1)},n.prototype.GetValue=function(n){var t=this.keys.indexOf(n,0);return t!=-1?this.values[t]:null},n.prototype.SetValue=function(n,t){var i=this.keys.indexOf(n,0);return i!=-1?(this.keys[i]=n,this.values[i]=t,!0):!1},n.prototype.ContainsKey=function(n){for(var i=this.keys,t=0;t<i.length;++t)if(i[t]===n)return!0;return!1},n}();String.prototype.format=function(n){var i=this,r,t,u;if(arguments.length>0)if(arguments.length==1&&typeof n=="object")for(r in n)n[r]!=undefined&&(u=new RegExp("({"+r+"})","g"),i=i.replace(u,n[r]));else for(t=0;t<arguments.length;t++)arguments[t]!=undefined&&(u=new RegExp("({)"+t+"(})","g"),i=i.replace(u,arguments[t]));return i};var ResultData=function(){function n(n){this.ErrCode=0;this.ErrMessage="";this.Data=new n}return n}(),Networking=function(){function n(n){this.XTag="";this.ASync=!1;this.XTag=n}return n.prototype.AjaxGet=function(n,t){var r,i;if($.ajax({async:this.ASync,headers:{"X-WoodenBench-Protection":this.XTag},url:localStorage.getItem("_")+t,success:function(n){r=n},error:function(){r=!1}}),r===!1)return console.error("Get Value from "+t+"Failed!"),null;if(i=new ResultData(n),$.extend(i,r),i.ErrCode==0)return i.Data;console.warn("API Call At "+t+" ResultCode="+i.ErrCode);console.warn(i)},n}(),WoodenBenchWeb=function(){function n(){this.CurrentUser=new UserObject}return n.prototype.Initialise=function(n,t,i,r){this.Session=getCookie("Session");this.ApiTicket=t;this.Config=new TSDictionary(i,r);this.Network=new Networking(CryptoJS.SHA384("{0}:{1}:{2}".format(this.Session,this.ApiTicket,window.navigator.userAgent)).toString());localStorage.setItem("_",location.protocol+"//"+location.host);deserialize(n,this.CurrentUser)},n.prototype.GetMgmtBus=function(){return this.Network.AjaxGet(GetBusResultData,this.Config.GetValue("API_GetBuses").format(this.CurrentUser.ObjectId))},n.prototype.GetName=function(n){return this.Network.AjaxGet(GetUserNameData,this.Config.GetValue("API_GetName").format(n))},n.prototype.GetStudents=function(n,t){return this.Network.AjaxGet(GetStudentsData,this.Config.GetValue("API_GetStudents").format(n,t,this.Session))},n.prototype.QueryStudents=function(n,t,i){return this.Network.AjaxGet(GetStudentsData,this.Config.GetValue("API_QueryStudents").format(n,t,i))},n.prototype.BusIssueReport=function(n,t,i){return this.Network.AjaxGet(NewReportData,this.Config.GetValue("API_BusIssueReport").format(n,this.CurrentUser.ObjectId,t,i))},n.prototype.SignStudent=function(n,t,i,r){return this.Network.AjaxGet(SignStudentData,this.Config.GetValue("API_SignStudent").format(n,btoa("{0};{1};{2};{3}".format(i,r,this.CurrentUser.ObjectId,t))))},n.prototype.GetClassStudents=function(n){return this.Network.AjaxGet(GetStudentsData,this.Config.GetValue("API_GetClassStudents").format(n,this.CurrentUser.ObjectId))},n.prototype.GetMyChild=function(){return this.Network.AjaxGet(GetStudentsData,this.Config.GetValue("API_GetMyChildren").format(this.CurrentUser.ObjectId))},n.prototype.SetStudentState=function(n,t){return this.Network.AjaxGet(SignStudentData,this.Config.GetValue("API_SetStudentState").format(n,t))},n.prototype.GenerateReport=function(n){return this.Network.AjaxGet(PureMessageData,this.Config.GetValue("API_GenerateReport").format(n)).Message},n.prototype.NewWeekRecord=function(){return this.Network.AjaxGet(PureMessageData,this.Config.GetValue("API_NewWeek")).Message},n.prototype.SendMessage=function(n,t){return this.Network.AjaxGet(PureMessageData,this.Config.GetValue("API_SendMessage").format(n,t)).Message},n.prototype.SetWeekType=function(n){return this.Network.AjaxGet(PureMessageData,this.Config.GetValue("API_SetWeekType").format(n)).Message},n}(),wbWeb=new WoodenBenchWeb;